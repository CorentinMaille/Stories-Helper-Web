$("#create-switch-button").on('click',function(){switchTeamApp();$("#archive-team-button").removeClass("show");$("#open-team-button").removeClass("show")});$("#update-switch-button").on('click',function(){switchTeamApp()});$("#create-team-button").on('click',function(){$("#teamName-hidden-create").val($("#teamName").val());freeUsersIds.forEach(function(id,key){if($("#adding-user-"+id).hasClass("show")){$("#add-team-form").append("<input type='hidden' name='addingUser"+key+"' value='"+id+"'>")}});$("#add-team-form").trigger('submit')});$("#close-alert").on('click',function(){$(this).parent().removeClass('show alert-visible').css({'opacity':'0','display':'none'})});$("#update-team-button").on('click',function(){$("#teamName-hidden-update").val($("#teamName").val());Obj=Project["teams"];ProjectTeams=[];Object.keys(Obj).forEach(key=>ProjectTeams.push({rowid:Obj[key]["rowid"],users:Obj[key]["users"]}));teamId=$("#team-id-update-input").val();ProjectTeams.forEach(team=>{Obj=team["users"];users=[];Object.keys(Obj).forEach(key=>users.push({rowid:Obj[key]["rowid"]}));teamRowid=team["rowid"];if(teamId==teamRowid){users.forEach(function(user,key){userRowid=user["rowid"];if($("#freeing-user-"+userRowid).hasClass("show")){$("#update-team-form").append("<input type='hidden' name='removingUser"+key+"' value='"+userRowid+"'>")}});freeUsersIds.forEach(function(userId,key){if(!$("#free-user-"+userId).hasClass("show")){$("#update-team-form").append("<input type='hidden' name='addingUser"+key+"' value='"+userId+"'>")}})}});$("#update-team-form").trigger('submit')});var searchIsEnabled=true;$('#project-dashboard-search-bar').on('input',function(){if(searchIsEnabled){$('#tbody-free-users').empty();var query=$(this).val().toString();if(query.length>0){$('#loading-modal').modal('show');searchIsEnabled=false;$.ajax({async:true,url:AJAX_URL+"admin/projectDashboard.php?action=search&query="+query,success:function(data){var associates=JSON.parse(data);if(associates){var append='';associates.forEach(associate=>{append+=['<tr class="collapse show" id="free-user-'+user.rowid+'">','<td>'+user.lastname+'</td>','<td>'+user.firstname+'</td>','<td>','<button onclick="toggleUserToTeam('+user.rowid+')" class="custom-button success px-2">','Ajouter','</button>','</td>','</tr>'].join('')});$('#tbody-free-users').append(append)}searchIsEnabled=true;$('#loading-modal').modal('hide');$('#project-dashboard-search-bar').focus()}})}else{$('#tbody-free-users').append(loadedAssociates);initLoadMoreLink()}}});var loadedAssociates=$('#tbody-free-users').children();initLoadMoreLink();function initLoadMoreLink(){$("#load-more").off('click').on('click',function(){$("#loading-modal").modal('show');$.ajax({async:true,url:AJAX_URL+"admin/projectDashboard.php?action=loadmore&offset="+offset,success:function(data){var users=JSON.parse(data);$('#load-more-line').remove();if(Array.isArray(users)&&users.length>0){offset+=30;var append='';users.forEach(user=>{append+=['<tr class="collapse show" id="free-user-'+user.rowid+'">','<td>'+user.lastname+'</td>','<td>'+user.firstname+'</td>','<td>','<button onclick="toggleUserToTeam('+user.rowid+')" class="custom-button success px-2">','Ajouter','</button>','</td>','</tr>'].join('')});$('#tbody-free-users').append(append);if(users.length==30){var append=['<tr id="load-more-line">','<td class="text-center" colspan="5">','<a id="load-more" type="button" class="custom-link py-0" style="font-size: 2rem;">Load more</a>','</td>','</tr>'].join('');$('#tbody-users').append(append)}$("#loading-modal").modal('hide');initLoadMoreLink()}}})})}function switchTeamApp(){$("#create-switch-button").toggleClass("show");$("#update-switch-button").toggleClass("show");title=$("#team-title").text();if(title=="Création des équipes"){$("#team-title").text("Modification des équipes")}else{$("#team-title").text("Création des équipes")}$("#create-team-button").toggleClass("show");$("#update-team-button").toggleClass("show");$("#delete-team-button").toggleClass("show");$("#project-teams-title").toggleClass("show");$("#project-teams-div").toggleClass("show");$("#teamName").val("");l=freeUsersIds.length;for(i=0;i<l;i+=1){if($("#free-user-"+freeUsersIds[i]).hasClass("show")){$("#adding-user-"+freeUsersIds[i]).removeClass("show")}if($("#adding-user-"+freeUsersIds[i]).hasClass("show")){$("#adding-user-"+freeUsersIds[i]).removeClass("show");$("#free-user-"+freeUsersIds[i]).addClass("show")}}l=teamIds.length;for(i=0;i<l;i+=1){if($(".team-members-"+teamIds[i]).hasClass("show")){$(".team-members-"+teamIds[i]).removeClass("show")}}$("#delete-team-button").attr('href',CONTROLLERS_URL+'admin/projectDashboard.php?action=deleteTeam&idProject='+projectId)};function toggleUserToTeam(userRowid){$("#free-user-"+userRowid).toggleClass("show");$("#adding-user-"+userRowid).toggleClass("show")}function toggleUserToExistingTeam(userRowid){$("#freeing-user-"+userRowid).toggleClass("show");$("#adding-again-user-"+userRowid).toggleClass("show")}function showTeamMembers(teamRowid,teamName){$.ajax({async:true,url:AJAX_URL+"admin/projectDashboard.php?action=getTeamActive&teamId="+teamRowid,success:function(data){teamActive=data;teamActive=teamActive.replace("\"",'').replace("\"",'');teamActive=parseInt(teamActive);if(teamActive==0){$("#archive-team-button").removeClass("show");$("#open-team-button").addClass("show").attr('href',CONTROLLERS_URL+"admin/projectDashboard.php?action=openTeam&teamId="+teamRowid+"&idProject="+projectId)}else{$("#archive-team-button").addClass("show").attr('href',CONTROLLERS_URL+"admin/projectDashboard.php?action=archiveTeam&teamId="+teamRowid+"&idProject="+projectId);$("#open-team-button").removeClass("show")}}});$("[id^=freeing-user-]").removeClass("show");$("[id^=adding-again-user-]").removeClass("show");$(".team-members-"+teamRowid).addClass("show");$("#team-id-update-input").val(teamRowid);$("#delete-team-button").addClass('show');$("#delete-team-button").attr('href',CONTROLLERS_URL+'admin/projectDashboard.php?action=deleteTeam&teamId='+teamRowid+'&idProject='+projectId);$("#map-btn").attr('href',CONTROLLERS_URL+'admin/map.php?projectId='+projectId+'&teamId='+teamRowid);$("#teamName").val(teamName);teamIds.forEach(element=>{elementTeamName=$("#team-sticker-"+element).children().first().text();$("#team-sticker-"+element).off('click').click(function(){showTeamMembers(element,elementTeamName)})})}