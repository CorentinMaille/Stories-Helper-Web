function init(){var t,e;$(".task-bubble").off("hover").hover(function(){$(this).css({"background-color":"#eeeff0",cursor:"pointer"}),$(this).children().css({"background-color":"#eeeff0",cursor:"pointer"})},function(){$(this).css({"background-color":"white",cursor:"default"}),$(this).children().css({"background-color":"white",cursor:"default"})}),$(".task-bubble-input").off("focus").focus(function(){$(".task-bubble-input").prop("disabled",!0),$("#column-details").removeClass("show"),$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),$(".task-buttons-container").removeClass("show"),$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#task-comment-container").children().remove(),$("#task-members-container").children().remove(),$("#attributed-member-button").removeClass("show"),$("#attribute-member-button").removeClass("show"),$("#desattribute-member-button").removeClass("show");var a=$(this).val();$("#task-title").val(a),$(this).parent().next().find(".task-buttons-container").first().addClass("show"),columnId=$(this).parents(".project-column").first().find(".columnId-input").val(),taskDiv=$(this).parents(".task").first(),t=taskDiv.find(".taskId-input").val(),$("#up-task-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=upTask&taskId="+t+"&columnId="+columnId,success:function(t){prevTask=taskDiv.prevAll(".task").first(),taskDiv.insertBefore(prevTask),$("#loading-modal").modal("hide")}})}),$("#down-task-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=downTask&taskId="+t+"&columnId="+columnId,success:function(t){nextTask=taskDiv.nextAll(".task").first(),taskDiv.insertAfter(nextTask),$("#loading-modal").modal("hide")}})}),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getTaskComments&taskId="+t,success:function(a){if(null!=a){for(a=$.parseJSON(a),comments=a.comments,l=comments.length,i=0;i<l;i++){note=comments[i].note,note=null==note?"":note,admin=comments[i].admin,author=comments[i].author,authorId=comments[i].fk_user,tms=comments[i].tms;var s=["<div class='task-comment-div'>","<input type='hidden' class='comment-task-id' value='"+comments[i].rowid+"'>","<input type='hidden' class='comment-author-id' value='"+authorId+"'>","<textarea "].join("");0==comments[i].isAuthor&&(s+="readonly "),s+=["class='mt-3 card task-comment px-2 pt-3 text-center' name='' cols='30' rows='3'>",note,"</textarea>","<div class='mt-1'>","<button class='btn w-100 "].join(""),1==admin?s+="btn-outline-danger":s+="btn-outline-classic",s+=[" comment-author'>",author,"</button>","</div>","<div class='col-5 pe-0'>","<span class='w-100' style='color:grey;font-size:small'>",tms,"</span>","</div>","</div>","</div>"].join(""),$("#task-comment-container").prepend(s)}initComment()}$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getTaskMembers&taskId="+t,success:function(a){for($(".task-bubble-input").prop("disabled",!1),task=$.parseJSON(a),members=task.members,l=members.length,i=0;i<l;i++){var s=["<div class='task-member'>","<input type='hidden' class='task-member-id' value='"+members[i].rowid+"'>","<input class='w-90 sticker mx-auto mt-2 hover text-center form-control' readonly value='"+members[i].lastname+" "+members[i].firstname+"'>","</div>"].join("");$("#task-members-container").prepend(s)}$("#members-switch-button").off("click").click(function(){$(".members-label").toggleClass("show"),$("#team-members-container").toggleClass("show"),$("#task-members-container").toggleClass("show"),$("#desattribute-member-button").removeClass("show"),$("#attribute-member-button").removeClass("show"),$("#attributed-member-button").removeClass("show")}),$(".team-member").off("click").click(function(){e=(e=$(this).find(".team-member-id").val()).replace('"'," ").replace('"'," "),memberName=$(this).find(".sticker").val(),$(".task-member-id[value='"+e+"']").length>0?($("#attributed-member-button").addClass("show"),$("#attribute-member-button").removeClass("show")):($("#attribute-member-button").addClass("show"),$("#attributed-member-button").removeClass("show"))}),$(".task-member").off("click").click(function(){e=(e=$(this).find(".task-member-id").val()).replace('"'," ").replace('"'," "),$("#desattribute-member-button").addClass("show")}),$("#attribute-member-button").off("click").click(function(){btn=$(this),0==$(".task-member-id[value='"+e+"']").length&&$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=attributeMemberToTask&taskId="+t+"&memberId="+e,success:function(t){$(".team-member-id[value='"+e+"']").parent().css("opacity","35%"),btn.removeClass("show");var a=["<div class='task-member'>","<input type='hidden' class='task-member-id' value='"+e+"'>","<input class='w-90 sticker mx-auto mt-2 hover text-center form-control' readonly value='"+memberName+"'>","</div>"].join("");$("#task-members-container").prepend(a),$(".task-member").off("click").click(function(){e=(e=$(this).find(".task-member-id").val()).replace('"'," ").replace('"'," "),$("#desattribute-member-button").addClass("show")})}})}),$("#desattribute-member-button").off("click").click(function(){btn=$(this),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=desattributeMemberToTask&taskId="+t+"&memberId="+e,success:function(t){$(".team-member-id[value='"+e+"']").parent().css("opacity","100%"),btn.removeClass("show"),$(".task-member-id[value='"+e+"']").parent().remove()}})})}})}}),$("#task-details").addClass("show")}),initTask(),$("#add-comment-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addTaskComment&taskId="+t,success:function(t){var e=["<div class='task-comment-div'>","<input type='hidden' class='comment-task-id' value='"+t.replace('"'," ").replace('"'," ")+"'>","<input type='hidden' class='comment-author-id' value='"+idUser+"'>","<textarea class='mt-3 card task-comment px-2 pt-3 text-center' name='' cols='30' rows='3'></textarea>","<div class='d-flex justify-content-start mt-1'>","<button class='btn btn-outline-classic comment-author'>",username,"</button>","</div>","</div>"].join("");$("#task-comment-container").prepend(e),$("#loading-modal").modal("hide"),initComment()}})}),initComment()}function initTask(){$(".add-task-btn").off("click").click(function(){$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),addTaskBtn=$(this),columnId=addTaskBtn.parents(".column-title").prev().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addTask&columnId="+columnId,success:function(t){$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getLastTaskId",success:function(t){t=$.parseJSON(t),taskId=t.rowid,taskId=taskId.replace('"'," ").replace('"'," ");var e=["<div class='task'>","<input class='taskId-input' type='hidden' value='"+taskId+"'>","<button class='btn btn-outline-classic disabled task-author mt-2 ms-2 px-0 w-50 overflow-x'>",username,"</button>","<div class='task-bubble pt-2 mb-1 mt-1 mx-2'>","<textarea class='task-bubble-input text-center'></textarea>","</div>","<div class='d-flex justify-content-between pe-2 ps-2'>","<div class='collapse mx-auto task-buttons-container'>","<i class='bi bi-check-lg btn btn-outline-success task-check'></i>","<i class='bi bi-trash ms-1 btn btn-outline-danger task-delete'></i>","<i class='bi bi-caret-left-fill ms-1 btn btn-outline-dark arrow-img-btn task-to-left'></i>","<i class='bi bi-caret-right-fill ms-1 btn btn-outline-dark arrow-img-btn task-to-right'></i>","<i class='bi bi-archive-fill task-archive ms-1 me-1 btn btn-outline-danger'></i>","</div>","</div>","</div>"].join("");addTaskBtn.parents(".column-title").next().prepend(e),$("#loading-modal").modal("hide"),init()}})}})}),$(".task-check").off("click").click(function(){$(this).parent().removeClass("show"),taskName=$(this).parents(".task").find(".task-bubble").first().find(".task-bubble-input").val(),taskId=$(this).parents(".task").find(".taskId-input").first().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateTask&taskId="+taskId+"&taskName="+taskName,success:function(){$("#loading-modal").modal("hide")}})}),$(".task-delete").off("click").click(function(){$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),taskId=$(this).parents(".task").first().find(".taskId-input").val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteTask&taskId="+taskId,success:function(){$("#loading-modal").modal("hide")}}),task=$(this).parents(".task").first(),task.remove(),$("#task-details").removeClass("show")}),$(".task-to-left").click(function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),newColumn=task.parents(".project-column").prevAll(".project-column").first(),updateTaskColumn(task,taskId,newColumn)}),$(".task-to-right").click(function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),newColumn=task.parents(".project-column").nextAll(".project-column").first(),updateTaskColumn(task,taskId,newColumn)}),$(".task-archive").click(function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=archiveTask&taskId="+taskId,success:function(t){task.remove(),$("#loading-modal").modal("hide")}})})}function initCol(){var t;$(".column-title-name").off("click").click(function(){$("#task-details").removeClass("show"),$("#add-column-form").removeClass("show"),$("#column-details-check-btn").removeClass("visible").addClass("invisible"),$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),$("#column-details").addClass("show"),$("#column-title").val($(this).find(".column-title-text").first().text()),t=$(this).parents(".column-title").first().prevAll(".columnId-input").first().val()}),$(".delete-col-btn").off("click").click(function(){t=$(this).parents(".column-title").prev().val(),$(this).parents(".project-column").remove(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteColumn&columnId="+t,success:function(){$("#column-details").removeClass("show"),$("#loading-modal").modal("hide")}})}),$("#left-column-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=leftColumn&columnId="+t+"&teamId="+teamId,success:function(){column=$(".columnId-input[value='"+t+"']").parents(".project-column").first(),column.insertBefore(column.prevAll(".project-column").first()),$("#loading-modal").modal("hide")}})}),$("#right-column-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=rightColumn&columnId="+t+"&teamId="+teamId,success:function(e){column=$(".columnId-input[value='"+t+"']").parents(".project-column").first(),column.insertAfter(column.nextAll(".project-column").first()),$("#loading-modal").modal("hide")}})}),$("#column-details-delete-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteColumn&columnId="+t,success:function(){$(".columnId-input[value='"+t+"']").parents(".project-column").first().remove(),$("#column-details").removeClass("show"),$("#loading-modal").modal("hide")}})}),$("#column-details-check-btn").off("click").click(function(){$("#loading-modal").modal("show"),$("#column-details-check-btn").removeClass("visible").addClass("invisible"),columnName=$("#column-title").val(),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateColumn&columnId="+t+"&columnName="+columnName,success:function(e){$(".columnId-input[value='"+t+"']").nextAll(".column-title").first().find(".column-title-text").first().text(columnName),$("#loading-modal").modal("hide")}})}),$("#column-title").off("focus").focus(function(){$("#column-details-check-btn").addClass("visible").removeClass("invisible")})}function initComment(){var t,e="";$(".task-comment").off("focus").focus(function(){commentAuthorId=$(this).prevAll(".comment-author-id").first().val(),commentAuthorId=commentAuthorId.replace('"'," ").replace('"'," "),commentAuthorId==idUser?($("#check-comment-btn").addClass("show"),$("#delete-comment-btn").addClass("show"),$("#add-comment-btn").removeClass("show")):($("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show")),t=(t=$(this).prevAll(".comment-task-id").first().val()).replace('"'," ").replace('"'," ")}),$(".task-comment").off("keyup").keyup(function(){e=$(this).val()}),$("#check-comment-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateTaskNote&commentId="+t+"&taskNote="+e,success:function(t){$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show"),$("#loading-modal").modal("hide")}})}),$("#delete-comment-btn").off("click").click(function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteTaskNote&commentId="+t,success:function(e){$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show"),$(".comment-task-id[value='"+t+"']").parents(".task-comment-div").first().remove(),$("#loading-modal").modal("hide")}})})}function updateTaskColumn(t,e,a){newColumnId=0!=a.length&&a.find(".columnId-input").first().val(),newColumnId&&($("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=taskColumnUpdate&taskId="+e+"&columnId="+newColumnId,success:function(e){t.prependTo(a.find(".column-content").first()),$("#loading-modal").modal("hide")}}))}$("body").css("overflow-y","hidden"),init(),initCol(),$("#add-column-btn").click(function(){$("#archive-btn").removeClass("show"),$("#add-column-form").toggleClass("show"),$("#task-details").removeClass("show"),$("#column-details").removeClass("show"),$(this).toggleClass("show")}),$("#cancel-column").click(function(){$("#add-column-form").toggleClass("show"),$("#add-column-btn").toggleClass("show"),$("#archive-btn").addClass("show")}),$("#archive-btn").click(function(){$("#columns-container").parent().removeClass("show"),$("#details-section").removeClass("show"),$("#archive-confirmation").addClass("show")}),$("#cancel-archive").click(function(){$("#columns-container").parent().addClass("show"),$("#details-section").addClass("show"),$("#archive-confirmation").removeClass("show")}),$("#close-details").click(function(){$(this).removeClass("show"),$("#details-section").removeClass("show"),$("#left-section").removeClass("col-10").addClass("col"),$("#open-right-section").addClass("show")}),$("#open-right-section").click(function(){$("#close-details").addClass("show"),$("#details-section").addClass("show"),$("#left-section").removeClass("col").addClass("col-10"),$(this).removeClass("show")}),$(".close-alert").click(function(){$(this).parent().removeClass("show alert-visible")}),$("#add-column-form").find("#create-column").click(function(){$("#archive-btn").addClass("show"),$("#add-column-form").removeClass("show"),columnName=$("#columnName-input").val(),columnName=0==columnName.length?" ":columnName,columnNameInput=$(this).prev(),btnColumnForm=$(this),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addColumn&columnName="+columnName+"&teamId="+teamId,success:function(t){$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getLastColumnId",success:function(t){columnId=t,columnId=columnId.replace('"',"").replace('"',""),columnNameInput.val(""),btnColumnForm.addClass("show");var e=["<div class='project-column'>","<input class='columnId-input' type='hidden' value='"+columnId+"'>","<div class='column-title text-center'>","<div class='row'>","<div class='col-7 pt-3 ps-2 ms-3 pe-0 column-title-name'>","<div class='overflow-x'>","<b class='column-title-text'>",columnName,"</b>","</div>","</div>","<ul class='offset-1 col-3 pt-2 ps-0'>","<li class='me-2'>","<button class='btn btn-outline-dark add-task-btn'>","New","</button>","</li>","<li class='mt-2 me-2'>","<button class='btn btn-outline-danger delete-col-btn'>","Delete","</button>","</li>","</ul>","</div>","</div>","<div class='column-content'>","</div>","</div>"].join("");$("#columns-container").append(e),$("#add-column-btn").toggleClass("show"),$("#loading-modal").modal("hide"),initTask(),initCol()}})}})});